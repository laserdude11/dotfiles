#!/bin/sh

PUNCHFILE="$HOME/org/work.timeclock"

clocked_in () {
    status=$(sed '/^$/d' "$PUNCHFILE" | tail -1 | cut -d' ' -f1)
    [ "i" = "$status" ]
    return $?
}

clock_in () {
    echo "i $(date '+%Y-%m-%d %H:%M:%S') $@" >> $PUNCHFILE
}

clock_out () {
    echo "o $(date '+%Y-%m-%d %H:%M:%S')" >> $PUNCHFILE
}

toggle_punch () {
	if clocked_in; then
		clock_out $@
	else
	    clock_in $@
    fi
}

cmd=$1
shift

case $cmd in
	show)
		if clocked_in; then
			echo "You are clocked in"
		else
			echo "You are clocked out"
		fi
	;;
    ""|toggle)
        toggle_punch $@
	;;
    switch)
	    if clocked_in; then
	        clock_out
	    fi
        clock_in $@
	;;
    "in")
	    if ! clocked_in; then
	        clock_in $@
	    else
            echo "Already clocked in."
            exit 1
	    fi
	;;
    "out")
	    if clocked_in; then
	        clock_out $@
	    else
            echo "Already clocked out."
            exit 1
	    fi
	;;
    *)
	    echo "unrecognized command: $cmd"
	;;
esac

